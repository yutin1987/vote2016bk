import supertest from 'supertest-as-promised';
import cheerio from 'cheerio';
import lodash from 'lodash';
import promise from 'bluebird';
import fs from 'fs';

const req = supertest('http://vote2016.cec.gov.tw/zh_TW/')

const data = [
  'T1/n100010000000000.html',
  'T1/n100010100000000.html',
  'T1/n100010100000000.html',
  'T1/n100010200000000.html',
  'T1/n100010200000000.html',
  'T1/n100020000000000.html',
  'T1/n100030000000000.html',
  'T1/n100040000000000.html',
  'T1/n100050000000000.html',
  'T1/n100060000000000.html',
  'T1/n100070000000000.html',
  'T1/n100080000000000.html',
  'T1/n100010000000000.html',
  'T1/n100010100000000.html',
  'T1/n100010100000000.html',
  'T1/n100010200000000.html',
  'T1/n100010200000000.html',
  'T1/n100020000000000.html',
  'T1/n100030000000000.html',
  'T1/n100040000000000.html',
  'T1/n100050000000000.html',
  'T1/n100060000000000.html',
  'T1/n100070000000000.html',
  'T1/n100080000000000.html',
  'T1/n100080900000000.html',
  'T1/n100080900000000.html',
  'T1/n100081200000000.html',
  'T1/n100081200000000.html',
  'T1/n200010000000000.html',
  'T1/n200020000000000.html',
  'T1/n200030000000000.html',
  'T1/n200040000000000.html',
  'T1/n200050000000000.html',
  'T1/n200060000000000.html',
  'T1/n200070000000000.html',
  'T1/n200080000000000.html',
  'T1/n200090000000000.html',
  'T1/n200100000000000.html',
  'T1/n200110000000000.html',
  'T1/n200120000000000.html',
  'T1/n300010000000000.html',
  'T1/n300010100000000.html',
  'T1/n300010100000000.html',
  'T1/n300010200000000.html',
  'T1/n300010200000000.html',
  'T1/n300010300000000.html',
  'T1/n300010300000000.html',
  'T1/n300020000000000.html',
  'T1/n300030000000000.html',
  'T1/n300040000000000.html',
  'T1/n300050000000000.html',
  'T1/n300060000000000.html',
  'T1/n400010000000000.html',
  'T1/n400010100000000.html',
  'T1/n400010100000000.html',
  'T1/n400010200000000.html',
  'T1/n400010200000000.html',
  'T1/n400010300000000.html',
  'T1/n400010300000000.html',
  'T1/n400010400000000.html',
  'T1/n400010400000000.html',
  'T1/n400010500000000.html',
  'T1/n400010500000000.html',
  'T1/n400020000000000.html',
  'T1/n400030000000000.html',
  'T1/n400040000000000.html',
  'T1/n400050000000000.html',
  'T1/n400060000000000.html',
  'T1/n400070000000000.html',
  'T1/n400080000000000.html',
  'T1/n500010000000000.html',
  'T1/n500020000000000.html',
  'T1/n500030000000000.html',
  'T1/n500032700000000.html',
  'T1/n500032700000000.html',
  'T1/n500032800000000.html',
  'T1/n500032800000000.html',
  'T1/n500032900000000.html',
  'T1/n500032900000000.html',
  'T1/n500040000000000.html',
  'T1/n500050000000000.html',
  'T1/n600010000000000.html',
  'T1/n600020000000000.html',
  'T1/n600030000000000.html',
  'T1/n600040000000000.html',
  'T1/n600050000000000.html',
  'T1/n600060000000000.html',
  'T1/n600063200000000.html',
  'T1/n600063200000000.html',
  'T1/n600070000000000.html',
  'T1/n600080000000000.html',
  'T1/n600090000000000.html',
  'T1/n701010000000000.html',
  'T1/n701010100000000.html',
  'T1/n701010100000000.html',
  'T1/n701010200000000.html',
  'T1/n701010200000000.html',
  'T1/n701010300000000.html',
  'T1/n701010300000000.html',
  'T1/n701010400000000.html',
  'T1/n701010400000000.html',
  'T1/n701010500000000.html',
  'T1/n701010500000000.html',
  'T1/n701010600000000.html',
  'T1/n701010600000000.html',
  'T1/n701010700000000.html',
  'T1/n701010700000000.html',
  'T1/n701010800000000.html',
  'T1/n701010800000000.html',
  'T1/n701010900000000.html',
  'T1/n701010900000000.html',
  'T1/n701011000000000.html',
  'T1/n701011000000000.html',
  'T1/n701011100000000.html',
  'T1/n701011100000000.html',
  'T1/n701011200000000.html',
  'T1/n701011200000000.html',
  'T1/n701011300000000.html',
  'T1/n701011300000000.html',
  'T1/n702010000000000.html',
  'T1/n702010100000000.html',
  'T1/n702010100000000.html',
  'T1/n702010200000000.html',
  'T1/n702010200000000.html',
  'T1/n702010300000000.html',
  'T1/n702010300000000.html',
  'T1/n702010400000000.html',
  'T1/n702010400000000.html',
  'T1/n702010500000000.html',
  'T1/n702010500000000.html',
  'T1/n702010600000000.html',
  'T1/n702010600000000.html',
  'T1/n702010700000000.html',
  'T1/n702010700000000.html',
  'T1/n702010800000000.html',
  'T1/n702010800000000.html',
  'T1/n702020000000000.html',
  'T1/n703010000000000.html',
  'T1/n703020000000000.html',
  'T1/n703030000000000.html',
  'T1/n703031000000000.html',
  'T1/n703031000000000.html',
  'T1/n703031100000000.html',
  'T1/n703031100000000.html',
  'T1/n703031200000000.html',
  'T1/n703031200000000.html',
  'T1/n703031300000000.html',
  'T1/n703031300000000.html',
  'T1/n703031400000000.html',
  'T1/n703031400000000.html',
  'T1/n703031500000000.html',
  'T1/n703031500000000.html',
  'T1/n703031600000000.html',
  'T1/n703031600000000.html',
  'T1/n703031700000000.html',
  'T1/n703031700000000.html',
  'T1/n703031800000000.html',
  'T1/n703031800000000.html',
  'T1/n703031900000000.html',
  'T1/n703031900000000.html',
  'T1/n703040000000000.html',
  'T1/n704010000000000.html',
  'T1/n704010100000000.html',
  'T1/n704010100000000.html',
  'T1/n704010200000000.html',
  'T1/n704010200000000.html',
  'T1/n704010300000000.html',
  'T1/n704010300000000.html',
  'T1/n704010400000000.html',
  'T1/n704010400000000.html',
  'T1/n704010500000000.html',
  'T1/n704010500000000.html',
  'T1/n704010600000000.html',
  'T1/n704010600000000.html',
  'T1/n704020000000000.html',
  'T1/n705010000000000.html',
  'T1/n705020000000000.html',
  'T1/n705021200000000.html',
  'T1/n705021200000000.html',
  'T1/n705021300000000.html',
  'T1/n705021300000000.html',
  'T1/n705021400000000.html',
  'T1/n705021400000000.html',
  'T1/n705021500000000.html',
  'T1/n705021500000000.html',
  'T1/n705021600000000.html',
  'T1/n705021600000000.html',
  'T1/n705021700000000.html',
  'T1/n705021700000000.html',
  'T1/n705021800000000.html',
  'T1/n705021800000000.html',
  'T1/n705021900000000.html',
  'T1/n705021900000000.html',
  'T1/n705022000000000.html',
  'T1/n705022000000000.html',
  'T1/n706010000000000.html',
  'T1/n706010100000000.html',
  'T1/n706010100000000.html',
  'T1/n706010200000000.html',
  'T1/n706010200000000.html',
  'T1/n706010300000000.html',
  'T1/n706010300000000.html',
  'T1/n706010400000000.html',
  'T1/n706010400000000.html',
  'T1/n706010500000000.html',
  'T1/n706010500000000.html',
  'T1/n706010600000000.html',
  'T1/n706010600000000.html',
  'T1/n706010700000000.html',
  'T1/n706010700000000.html',
  'T1/n706010800000000.html',
  'T1/n706010800000000.html',
  'T1/n706020000000000.html',
  'T1/n707010000000000.html',
  'T1/n707010100000000.html',
  'T1/n707010100000000.html',
  'T1/n707010200000000.html',
  'T1/n707010200000000.html',
  'T1/n707010300000000.html',
  'T1/n707010300000000.html',
  'T1/n707010400000000.html',
  'T1/n707010400000000.html',
  'T1/n707010500000000.html',
  'T1/n707010500000000.html',
  'T1/n707010600000000.html',
  'T1/n707010600000000.html',
  'T1/n707010700000000.html',
  'T1/n707010700000000.html',
  'T1/n707010800000000.html',
  'T1/n707010800000000.html',
  'T1/n707010900000000.html',
  'T1/n707010900000000.html',
  'T1/n707011000000000.html',
  'T1/n707011000000000.html',
  'T1/n707011100000000.html',
  'T1/n707011100000000.html',
  'T1/n707011200000000.html',
  'T1/n707011200000000.html',
  'T1/n707011300000000.html',
  'T1/n707011300000000.html',
  'T1/n707020000000000.html',
  'T1/n707030000000000.html',
  'T1/n708010000000000.html',
  'T1/n708010100000000.html',
  'T1/n708010100000000.html',
  'T1/n708010200000000.html',
  'T1/n708010200000000.html',
  'T1/n708010300000000.html',
  'T1/n708010300000000.html',
  'T1/n708010400000000.html',
  'T1/n708010400000000.html',
  'T1/n708010500000000.html',
  'T1/n708010500000000.html',
  'T1/n708010600000000.html',
  'T1/n708010600000000.html',
  'T1/n708010700000000.html',
  'T1/n708010700000000.html',
  'T1/n708010800000000.html',
  'T1/n708010800000000.html',
  'T1/n708010900000000.html',
  'T1/n708010900000000.html',
  'T1/n708011000000000.html',
  'T1/n708011000000000.html',
  'T1/n708011100000000.html',
  'T1/n708011100000000.html',
  'T1/n708011200000000.html',
  'T1/n708011200000000.html',
  'T1/n709010000000000.html',
  'T1/n709010100000000.html',
  'T1/n709010100000000.html',
  'T1/n709010200000000.html',
  'T1/n709010200000000.html',
  'T1/n709010300000000.html',
  'T1/n709010300000000.html',
  'T1/n709010400000000.html',
  'T1/n709010400000000.html',
  'T1/n709010500000000.html',
  'T1/n709010500000000.html',
  'T1/n709010600000000.html',
  'T1/n709010600000000.html',
  'T1/n709010700000000.html',
  'T1/n709010700000000.html',
  'T1/n709010800000000.html',
  'T1/n709010800000000.html',
  'T1/n709010900000000.html',
  'T1/n709010900000000.html',
  'T1/n709011000000000.html',
  'T1/n709011000000000.html',
  'T1/n709011100000000.html',
  'T1/n709011100000000.html',
  'T1/n709011200000000.html',
  'T1/n709011200000000.html',
  'T1/n709011300000000.html',
  'T1/n709011300000000.html',
  'T1/n710010000000000.html',
  'T1/n710010100000000.html',
  'T1/n710010100000000.html',
  'T1/n710010200000000.html',
  'T1/n710010200000000.html',
  'T1/n710010300000000.html',
  'T1/n710010300000000.html',
  'T1/n710010400000000.html',
  'T1/n710010400000000.html',
  'T1/n710010500000000.html',
  'T1/n710010500000000.html',
  'T1/n710010600000000.html',
  'T1/n710010600000000.html',
  'T1/n710010700000000.html',
  'T1/n710010700000000.html',
  'T1/n710010800000000.html',
  'T1/n710010800000000.html',
  'T1/n710010900000000.html',
  'T1/n710010900000000.html',
  'T1/n710011000000000.html',
  'T1/n710011000000000.html',
  'T1/n710011100000000.html',
  'T1/n710011100000000.html',
  'T1/n710011200000000.html',
  'T1/n710011200000000.html',
  'T1/n710011300000000.html',
  'T1/n710011300000000.html',
  'T1/n710011400000000.html',
  'T1/n710011400000000.html',
  'T1/n710011500000000.html',
  'T1/n710011500000000.html',
  'T1/n710011600000000.html',
  'T1/n710011600000000.html',
  'T1/n711010000000000.html',
  'T1/n711010100000000.html',
  'T1/n711010100000000.html',
  'T1/n711010200000000.html',
  'T1/n711010200000000.html',
  'T1/n711010300000000.html',
  'T1/n711010300000000.html',
  'T1/n711010400000000.html',
  'T1/n711010400000000.html',
  'T1/n711010500000000.html',
  'T1/n711010500000000.html',
  'T1/n711010600000000.html',
  'T1/n711010600000000.html',
  'T1/n712010000000000.html',
  'T1/n712010100000000.html',
  'T1/n712010100000000.html',
  'T1/n712010200000000.html',
  'T1/n712010200000000.html',
  'T1/n712010300000000.html',
  'T1/n712010300000000.html',
  'T1/n712010400000000.html',
  'T1/n712010400000000.html',
  'T1/n712010500000000.html',
  'T1/n712010500000000.html',
  'T1/n712010600000000.html',
  'T1/n712010600000000.html',
  'T1/n712010700000000.html',
  'T1/n712010700000000.html',
  'T1/n713010000000000.html',
  'T1/n713010100000000.html',
  'T1/n713010100000000.html',
  'T1/n713010200000000.html',
  'T1/n713010200000000.html',
  'T1/n713010300000000.html',
  'T1/n713010300000000.html',
  'T1/n714010000000000.html',
  'T1/n714010100000000.html',
  'T1/n714010100000000.html',
  'T1/n714010200000000.html',
  'T1/n714010200000000.html',
  'T1/n801010000000000.html',
  'T1/n801010100000000.html',
  'T1/n801010100000000.html',
  'T1/n801010200000000.html',
  'T1/n801010200000000.html',
  'T1/n801010300000000.html',
  'T1/n801010300000000.html',
  'T1/n801010400000000.html',
  'T1/n801010400000000.html',
  'T1/n801010500000000.html',
  'T1/n801010500000000.html',
  'T1/n801010600000000.html',
  'T1/n801010600000000.html',
  'T1/n802010000000000.html',
  'T1/n802010100000000.html',
  'T1/n802010100000000.html',
  'T1/n802010200000000.html',
  'T1/n802010200000000.html',
  'T1/n802010300000000.html',
  'T1/n802010300000000.html',
  'T1/n802010400000000.html',
  'T1/n802010400000000.html',
];

promise.all(
  data.map((url) => {
    return req.get(url)
      .expect(200)
      .then(reply => {
        const $ = cheerio.load(reply.res.text);
        const title = $('#divContent tr').eq(0).text().trim();
        const tr = $('#divContent .tableT tr');
        return {
          title,
          content: tr.map((i, row) => $('td', row).map((j, column) => $(column).text().trim()).get().join(',')).get(),
        };
      }, err => {
        return {
          title: url,
          err,
        }
      });
  })
).then((result) => {
  fs.writeFileSync(`./t1/${Date.now()}.json`, JSON.stringify(result, null, 4));
});